<html>
    <head>
        <style>
        .inline-block {
            display:inline-block;
        }
        .inline{
            display:inline;
        }
        #searchBoxes {
            display:inline;
        }

        </style>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="sites.js"></script>
        <script src="siteNames.js"></script>
        <script src="sl.js"></script>
        <title>Avgångar</title>
    </head>
    <body>
        <div id="allStops">

        </div>
            <div id="searchBoxes">

            <div class="inline">
            <p>Station</p>
            <input id="siteSearchInput" type="text" onInput="searchSite()" />
            <ul id="siteSearchResult">
            </ul>
            </div>

            <div class="inline">
                <p>Destination</p>
                <input id="destinationSearchInput" type="text" onInput="searchDestination()" />
                <ul id="destinationSearchResult">
                </ul>
            </div>

            <div class="inline-block">
                <p>Busslinje</p>
                <input id="busSearchInput" type="text" />
            </div>
        </div>
        <button id="addSite" onClick="lol()">Lägg till</button>

        <script>
            let lol = () => {

                let site = document.getElementById("siteSearchInput").value;
                let destination = document.getElementById("destinationSearchInput").value;
                let buses = document.getElementById("busSearchInput").value;

                let id = sites.find(s => s.name === site).id;
                store(id, site, destination, buses);
                document.getElementById("allStops").textContent='';
            getStoredSites().forEach(s => {
                // {"id":4604,"site":"Ekstubben","destination":"Gullmarsplan","buses":"801"}
                getDepartures(s.id, [s.buses], [s.destination]).then(result => {
                    console.log(result)
                    let header  = document.createElement("h2")
                    header.textContent = s.site
                    document.getElementById("allStops").appendChild(header)
                    result.forEach(r => {
                        let row = document.createElement("p")
                        row.innerText = r.designation + " mot " + r.destination + " - " + r.display+"\n";
                    document.getElementById("allStops").appendChild(row)
                    })

                });
            });
            };
            console.log("stored", getStoredSites());
            getStoredSites().forEach(s => {
              // {"id":4604,"site":"Ekstubben","destination":"Gullmarsplan","buses":"801"}
                getDepartures(s.id, [s.buses], [s.destination]).then(result => {
                    console.log(result)
                    let header  = document.createElement("h2")
                    header.textContent = s.site
                    document.getElementById("allStops").appendChild(header)
                    result.forEach(r => {
                        let row = document.createElement("p")
                        row.innerText = r.designation + " mot " + r.destination + " - " + r.display+"\n";
                    document.getElementById("allStops").appendChild(row)
                    })

                });

            });
            let ekstubben = 4604;
            let norraSkondal = 1810;
            let gullmarsplan = 9189;
            let vattugatan = 1003;

            let updateDepartures = (id, data) => {
                let output = document.getElementById(id);
                output.innerText = "";
                data.forEach(d => {output.innerText+=d.designation + " mot " + d.destination + " - " + d.display + "\n"});

                let latestUpdate = document.getElementById("latestUpdate");
                let now = new Date();
                latestUpdate.innerText = `Senast uppdaterad:  ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`
            };
            /// https://www.trafiklab.se/api/our-apis/sl/transport/
            /*getDepartures(norraSkondal, ["801", "814"], ["Älta", "Södra Hedvigslund", "Stockholm C"]).then(result => {
                updateDepartures("norraSkondal", result);
            });
            getDepartures(ekstubben, ["801", "814"], ["Gullmarsplan"]).then(result => {
                updateDepartures("ekstubben", result);
            });
            getDepartures(gullmarsplan, ["801", "814"], ["Älta", "Södra Hedvigslund"]).then(result => {
                updateDepartures("gullmarsplan", result);
            });
            getDepartures(vattugatan, ["812C", "813C", "815C"], ["Tyresö Kyrka", "Nyfors", "Tyresö C"]).then(result => {
                updateDepartures("vattugatan", result);
            });*/

        </script>
    </body>
</html>
